<% title "Company List" %>
<div id="user_nav">
	<%= link_to ">>View my profile",{:controller=>'students',:action=>'show',:id=>@student.id} %>
</div>
<div id="content" class="container_16">
    	<!-- begin main content area -->
        <div id="page_content" class="grid_11 alpha">
        	<h3 class="content_title">Registration Details</h3>
        	
<% if !flash[:notice].blank? %>
<div>
<p align = "center"><%= flash[:notice] %></p>
</div>
<% end %>

<% if @companies!=[] %>
 <table border="2">
 <tr>
 	
   <th>Company Name</th>
   <th>Registration date</th>
   <th>Preplacement talk</th>
   <th>Test Date</th>
   <th>Interview date</th>
	<th colspan="2">Actions / Status</th>
 	<th>Placed?</th>
 	<th>Placed Students List</th>
   
 </tr>
 
 <% @companies.each do |company| %>
    <% @eligible=StudentRegistration.find_by_student_id_and_company_id(@student.id,company.id) %>
  
   <tr>
   <td> <%= company.cmp_name %> </td>
   <td> <%= company.reg_date %> </td>
   <% if company.preplacement_talk.to_s == '1980-01-01' %>
   		<td>Not Decided</td>
   <%else%>
   		<td> <%= company.preplacement_talk %> </td>
   	<%end%>
	<%if company.test_date.to_s == '1980-01-01' %>
    		<td>Not Decided</td>
    <%else%>
   			<td> <%= company.test_date %> </td>
   	<%end%>
   	<%if company.interview_date.to_s == '1980-01-01'%>
   		<td>Not Decided</td>
   	<%else%>
   		<td ><%= company.interview_date %> </td>
   	<%end%>

   <td> <%= link_to'Show Criterion',:action => 'display_criterion',:id=>company.id %> </td>
   
   
   <!-- if a student has not Registered Yet -->
   <% if @eligible.nil? %>
   
   		<!-- if a student has been placed in a service based company so he/she can't register for any more service type company  -->
   		<% if @student.placed? && @student.placed_company_type == 1 && Company.find_by_id(company.id).company_type == "SERVICE"  %>
   			<td>Not Eligible</td>
   		
   		<!-- if a student has been placed in a service based company but wants to register for a core type company and has the required cgpa -->			
   		<%elsif @student.placed? && @student.placed_company_type == 1 && @student.cgpa >= Branch.find_by_id(@student.branch_id).dream_option && Company.find_by_id(company.id).company_type == "CORE" %>
			<td><%= link_to 'Register Now',:action=>'register' ,:id=>company.id %></td>
		<!-- if a student has been placed in a service based company but wants to register for a core type company and has less than the required cgpa -->
		<%elsif @student.placed? && @student.placed_company_type == 1 && @student.cgpa < Branch.find_by_id(@student.branch_id).dream_option && Company.find_by_id(company.id).company_type == "CORE" %>
			<td>Not Eligible</td>			
		<!-- if a student has been placed in a core company, so he can't register for any other core type company -->
		<%elsif @student.placed? && @student.placed_company_type == 2 %>
			<td>Not Eligible</td>
		<!-- if a student has not been placed but wants to register -->		
		<%else%>
			<td><%= link_to 'Register Now',:action=>'register' ,:id=>company.id %></td>
   		<%end%>
	
		<!-- if a student has already registered for some company -->
   <% else %>
     	<!-- if a student has been placed in a service based company so he can't see the other service based company register options -->
     	<% if @student.placed? && @student.placed_company_type == 1 && Company.find_by_id(company.id).company_type == "SERVICE"  %>
     		<td>Not Eligible</td>
     	<!-- if a student has been placed in a core based company he cant see the registration details of any other company -->
     	<% elsif @student.placed? && @student.placed_company_type == 2 %>
     		<td>Not Eligible</td>
     	<!-- if a student has been placed in a service based company company and he wants to register for core based company but don't have the required cgpa -->
     	<%elsif @student.placed? && @student.placed_company_type == 1 && @student.cgpa < Branch.find_by_id(@student.branch_id).dream_option && Company.find_by_id(company.id).company_type == "CORE" %>
			<td>Not eligible</td>     		
		<!-- if a student has been placed in a service based company company and he wants to register for core based company and has the required cgpa -->	
     	<%elsif @student.placed? && @student.placed_company_type == 1 && @student.cgpa >= Branch.find_by_id(@student.branch_id).dream_option && Company.find_by_id(company.id).company_type == "CORE" %>		
     		<td><%= link_to 'Unregister Now',:action=>'unregister' ,:id=>company.id %> </td>
     	<!-- if a student has not been placed yet -->
     	<%else%>
     			<td><%= link_to 'Unregister Now',:action=>'unregister' ,:id=>company.id %> </td>
     	<%end%>
    <%end%>
   <% if !@eligible.nil? && @eligible.placed? %>
   		<td>Placed </td>
   	<%else%>
   		<td>Not Placed</td>
   	<%end%>
   	<td><%= link_to "Show_Placed" , :action => 'show_others', :id  => company.id %></td>
   </tr>
<% end %>
</table>
<% else %>
   <p>Sorry! There are no Companies available for registration<p>
<% end %>
</div>
</div>